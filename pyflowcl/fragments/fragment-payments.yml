tags:
  - name: payment
    description: "Creación de transacciones de pagos y cobros por email. Utilice el servicio **payment/create** para crear links de pagos o **payment/createEmail** para crear cobros por email."
paths:
  /payment/getStatus:
    get:
      tags:
        - payment
      summary: Obtiene el estado de una orden de pago.
      description: 'Este método se utiliza para obtener el estado de un pago. Se debe utilizar en la página callback del comercio para recibir notificaciones de pagos. Cada vez que el pagador efectúe un pago, **Flow** enviará vía POST una llamada a la página del comercio, pasando como parámetro un **token** que deberá utilizarse en este servicio.'
      parameters:
        - in: query
          name: apiKey
          description: apiKey del comercio
          required: true
          schema:
            type: string
        - in: query
          name: token
          description: token de la transacción enviado por Flow
          required: true
          schema:
            type: string
        - in: query
          name: s
          description: la firma de los parámetros efectuada con su secretKey
          required: true
          schema:
            type: string
      responses:
        '200':
          description: El objeto PaymentStatus
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentStatus'
        '400':
          description: error del Api
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: error interno de negocio
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /payment/getStatusByCommerceId:
    get:
      tags:
        - payment
      summary: 'Obtiene el estado de un pago en base al commerceId'
      description: 'Este método permite obtener el estado de un pago en base al **commerceId**'
      parameters:
        - in: query
          name: apiKey
          description: apiKey del comercio
          required: true
          schema:
            type: string
        - in: query
          name: commerceId
          description: Orden del comercio
          required: true
          schema:
            type: string
        - in: query
          name: s
          description: la firma de los parámetros efectuada con su secretKey
          required: true
          schema:
            type: string
      responses:
        '200':
          description: El objeto PaymentStatus
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentStatus'
        '400':
          description: error del Api
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: error interno de negocio
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /payment/getStatusByFlowOrder:
    get:
      tags:
        - payment
      summary: 'Obtiene el estado de un pago en base al número de orden Flow'
      description: 'Este método permite obtener el estado de un pago en base al **flowOrder**'
      parameters:
        - in: query
          name: apiKey
          description: apiKey del comercio
          required: true
          schema:
            type: string
        - in: query
          name: flowOrder
          description: número de orden Flow
          required: true
          schema:
            type: number
            example: 68977654
        - in: query
          name: s
          description: la firma de los parámetros efectuada con su secretKey
          required: true
          schema:
            type: string
      responses:
        '200':
          description: El objeto PaymentStatus
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentStatus'
        '400':
          description: error del Api
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: error interno de negocio
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /payment/getPayments:
    get:
      tags:
        - payment
      summary: 'Obtiene el listado de pagos recibidos en un día'
      description: 'Este método permite obtener la lista paginada de pagos recibidos en un día.Los objetos pagos de la lista tienen la misma estructura de los retornados en los servicios payment/getStatus'
      parameters:
        - in: query
          name: apiKey
          description: apiKey del comercio
          required: true
          schema:
            type: string
        - in: query
          name: date
          description: fecha de los pagos en formato yyyy-mm-dd
          required: true
          schema:
            type: string
        - in: query
          name: start
          description: Número de registro de inicio de la página. Si se omite el valor por omisión es 0.
          required: false
          schema:
            type: integer
        - in: query
          name: limit
          description: Número de registros por página. Si se omite el valor por omisón es 10. El valor máximo es de 100 registros por página.
          required: false
          schema:
            type: integer
        - in: query
          name: s
          description: la firma de los parámetros efectuada con su secretKey
          required: true
          schema:
            type: string
      responses:
        '200':
          description: "Lista paginada de pagos"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/List'
        '400':
          description: Error del Api
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Error de negocio
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /payment/getStatusExtended:
    get:
      tags:
        - payment
      summary: Obtiene el estado extendido de una orden de pago.
      description: 'Este método se utiliza para obtener el estado de un pago. A diferencia del /payment/getStatus este servicio retorna el tipo de pago, los 4 últimos dígitos de la tarjeta (si el pago se hizo con tarjeta) y la información del último intento de pago. Se debe utilizar en la página callback del comercio para recibir notificaciones de pagos. Cada vez que el pagador efectúe un pago, **Flow** enviará vía POST una llamada a la página del comercio, pasando como parámetro un **token** que deberá utilizarse en este servicio.'
      parameters:
        - in: query
          name: apiKey
          description: apiKey del comercio
          required: true
          schema:
            type: string
        - in: query
          name: token
          description: token de la transacción enviado por Flow
          required: true
          schema:
            type: string
        - in: query
          name: s
          description: la firma de los parámetros efectuada con su secretKey
          required: true
          schema:
            type: string
      responses:
        '200':
          description: El objeto PaymentStatusExtended
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentStatusExtended'
        '400':
          description: error del Api
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: error interno de negocio
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /payment/getStatusByFlowOrderExtended:
    get:
      tags:
        - payment
      summary: 'Obtiene el estado extendido de un pago en base al número de orden Flow'
      description: 'Este método permite obtener el estado de un pago en base al **flowOrder**. A diferencia del /payment/getStatusByFlowOrder este servicio retorna el tipo de pago, los 4 últimos dígitos de la tarjeta (si el pago se hizo con tarjeta) y la información del último intento de pago.'
      parameters:
        - in: query
          name: apiKey
          description: apiKey del comercio
          required: true
          schema:
            type: string
        - in: query
          name: flowOrder
          description: número de orden Flow
          required: true
          schema:
            type: number
            example: 68977654
        - in: query
          name: s
          description: la firma de los parámetros efectuada con su secretKey
          required: true
          schema:
            type: string
      responses:
        '200':
          description: El objeto PaymentStatusExtended
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentStatusExtended'
        '400':
          description: error del Api
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: error interno de negocio
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /payment/create:
    post:
      tags:
        - payment
      summary: Genera una orden de pago
      description: "Este método permite crear una orden de pago a **Flow** y recibe como respuesta la **URL** para redirigir el browser del pagador y el **token** que identifica la transacción. La url de redirección se debe formar concatenando los valores recibidos en la respuesta de la siguiente forma:\n\n **url** + \"?token=\" +**token**\n\n
      Una vez que el pagador efectúe el pago, **Flow** notificará el resultado a la página del comercio que se envió en el parámetro **urlConfirmation**."
      responses:
        '200':
          description: "url y token para redirigir el browser del pagador La url de redirección se debe formar concatenando los valores recibidos en la respuesta de la siguiente forma:\n\n **url** + \"?token=\" +**token**"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PayResponse'
        '400':
          description: "Error del Api"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: "Error de negocio"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                apiKey:
                  description: apiKey del comercio
                  type: string
                commerceOrder:
                  description: Orden del comercio
                  type: string
                subject:
                  description: Descripción de la orden
                  type: string
                currency:
                  description: Moneda de la orden
                  type: string
                amount:
                  description: Monto de la orden
                  type: number
                email:
                  description: email del pagador
                  type: string
                  format: email
                paymentMethod:
                  description: |
                    Identificador del medio de pago. Si se envía el identificador, el pagador será redireccionado directamente al medio de pago que se indique, de lo contrario Flow le presentará una página para seleccionarlo. El medio de pago debe haber sido previamente contratado. Podrá ver los identificadores de sus medios de pago en la sección "Mis Datos" ingresando a Flow con sus credenciales. Para indicar todos los medios de pago utilice el identificador:
                    - 9 Todos los medios
                  type: integer
                urlConfirmation:
                  description: url callback del comercio donde Flow confirmará el pago
                  type: string
                  format: uri
                urlReturn:
                  description: url de retorno del comercio donde Flow redirigirá al pagador
                  type: string
                  format: uri
                optional:
                  description: |
                    Datos opcionales en formato JSON clave = valor, ejemplo:
                      {"rut":"9999999-9","nombre":"cliente 1"}
                  type: string
                timeout:
                  description: tiempo en segundos para que una orden expire después de haber sido creada. Si no se envía este parámetro la orden no expirará y estará vigente para pago por tiempo indefinido. Si envía un valor en segundos, la orden expirará x segundos después de haber sido creada y no podrá pagarse.
                  type: integer
                merchantId:
                  description: Id de comercio asociado. Solo aplica si usted es comercio integrador.
                  type: string
                payment_currency:
                  description: Moneda en que se espera se pague la orden
                  type: string
                s:
                  description: la firma de los parámetros efectuada con su secretKey
                  type: string
              required:
                - apiKey
                - commerceOrder
                - subject
                - amount
                - email
                - urlConfirmation
                - urlReturn
                - s
      callbacks:
        paymentConfirmation:
          '{$request#/urlConfirmation}':
            post:
              requestBody:
                content:
                  application/x-www-form-urlencoded:
                    schema:
                      type: object
                      properties:
                        token:
                          description: hash token que identifica la transacción
                          type: string
              responses:
                '200':
                  description: Your server returns this code if it accepts the callback
  /payment/createEmail:
    post:
      tags:
        - payment
      summary: Genera un cobro por email
      description: "Permite generar un cobro por email. **Flow** emite un email al pagador que contiene la información de la Orden de pago y el link de pago correspondiente. Una vez que el pagador efectúe el pago, **Flow** notificará el resultado a la página del comercio que se envió en el parámetro **urlConfirmation**."
      responses:
        '200':
          description: "Al crear un cobro por email, Flow enviará el email directamente al pagador con un link de pago. El link de pago se forma  concatenando los valores recibidos en la respuesta de la siguiente forma:\n\n **url** + \"?token=\" +**token**"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PayResponse'
        '400':
          description: Error del api
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Error de negocio
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                apiKey:
                  description: apiKey del comercio
                  type: string
                commerceOrder:
                  description: Orden del comercio
                  type: string
                subject:
                  description: Descripción de la orden
                  type: string
                currency:
                  description: Moneda de la orden
                  type: string
                amount:
                  description: Monto de la orden
                  type: number
                email:
                  description: email del pagador
                  type: string
                  format: email
                urlConfirmation:
                  description: url callbak del comercio donde Flow confirmará el pago
                  type: string
                  format: uri
                urlReturn:
                  description: url de retorno del comercio donde Flow redirigirá al pagador
                  type: string
                  format: uri
                forward_days_after:
                  description: Número de días posteriores al envío del cobro para enviar una nueva notificación de persistencia si la orden no está pagada.
                  type: number
                forward_times:
                  description: Número de veces de envío de mail de persistencia.
                  type: number
                optional:
                  description: |
                    Datos opcionales en formato JSON clave = valor, ejemplo:
                      {"rut":"9999999-9","nombre":"cliente 1"}
                  type: string
                timeout:
                  description: tiempo en segundos para que una orden expire después de haber sido creada. Si no se envía este parámetro la orden no expirará y estará vigente para pago por tiempo indefinido. Si envía un valor en segundos, la orden expirará x segundos después de haber sido creada y no podrá pagarse.
                  type: integer
                merchantId:
                  description: Id de comercio asociado. Solo aplica si usted es comercio integrador.
                  type: string
                payment_currency:
                  description: Moneda en que se espera se pague la orden
                  type: string
                s:
                  description: la firma de los parámetros efectuada con su secretKey
                  type: string
              required:
                - apiKey
                - commerceOrder
                - subject
                - amount
                - email
                - urlConfirmation
                - urlReturn
                - s

components:
  schemas:
    PaymentStatus:
      description: Objeto que representa un cobro y si está pagado su correspondiente pago
      type: object
      nullable: true
      properties:
        flowOrder:
          type: integer
          description: El número de la orden de Flow
          example: 3567899
        commerceOrder:
          type: string
          description: El número de la orden del comercio
          example: sf12377
        requestDate:
          type: string
          description: La fecha de creación de la orden
          format: 'yyyy-mm-dd hh:mm:ss'
          example: '2017-07-21 12:32:11'
        status:
          type: integer
          description: |
            El estado de la order
            - 1 pendiente de pago
            - 2 pagada
            - 3 rechazada
            - 4 anulada
          example: 1
        subject:
          type: string
          description: El concepto de la orden
          example: game console
        currency:
          type: string
          description: La moneda
          example: CLP
        amount:
          type: number
          format: float
          description: El monto de la orden
          example: 12000
        payer:
          type: string
          description: El email del pagador
          example: pperez@gamil.com
        optional:
          type: string
          nullable: true
          description: datos opcionales enviados por el comercio en el request de creación de pago en el parámetro optional en formato JSon
          example:
            RUT: "7025521-9"
            ID: "899564778"
        pending_info:
          type: object
          description: Información para un pago pendiente cuando se generó un cupón de pago. Si no existen datos es que no se generó un cupón de pago.
          properties:
            media:
              type: string
              nullable: true
              description: El medio de pago utilizado para emitir el cupón de pago
              example: Multicaja
            date:
              type: string
              nullable: true
              description: La fecha de emisión del cupón de pago
              example: '2017-07-21 10:30:12'
        paymentData:
          description: Los datos del pago
          type: object
          properties:
            date:
              type: string
              nullable: true
              description: La fecha de pago
              example: '2017-07-21 12:32:11'
            media:
              type: string
              nullable: true
              description: El medio de pago utilizado
              example: webpay
            conversionDate:
              type: string
              nullable: true
              description: La fecha de conversión de la moneda
              example: '2017-07-21'
            conversionRate:
              type: number
              nullable: true
              format: float
              description: La tasa de conversión.
              example: 1.1
            amount:
              type: number
              nullable: true
              format: float
              description: El monto pagado
              example: 12000
            currency:
              type: string
              nullable: true
              description: La moneda con que se pagó
              example: CLP
            fee:
              type: number
              nullable: true
              format: float
              description: El costo del servicio
              example: 551
            taxes:
              type: number
              nullable: true
              format: float
              description: Impuestos
              example: 28
            balance:
              type: number
              nullable: true
              format: float
              description: El saldo a depositar
              example: 11499
            transferDate:
              type: string
              nullable: true
              description: La fecha de transferencia de los fondos a su cuenta bancaria.
              example: '2017-07-24'
        merchantId:
          description: Id de comercio asociado. Solo aplica si usted es comercio integrador.
          type: string
          nullable: true
    PaymentStatusExtended:
      description: Objeto que representa un cobro y si está pagado su correspondiente pago
      type: object
      nullable: true
      properties:
        flowOrder:
          type: integer
          description: El número de la orden de Flow
          example: 3567899
        commerceOrder:
          type: string
          description: El número de la orden del comercio
          example: sf12377
        requestDate:
          type: string
          description: La fecha de creación de la orden
          format: 'yyyy-mm-dd hh:mm:ss'
          example: '2017-07-21 12:32:11'
        status:
          type: integer
          description: |
            El estado de la order
            - 1 pendiente de pago
            - 2 pagada
            - 3 rechazada
            - 4 anulada
          example: 1
        subject:
          type: string
          description: El concepto de la orden
          example: game console
        currency:
          type: string
          description: La moneda
          example: CLP
        amount:
          type: number
          format: float
          description: El monto de la orden
          example: 12000
        payer:
          type: string
          description: El email del pagador
          example: pperez@gamil.com
        optional:
          type: string
          nullable: true
          description: datos opcionales enviados por el comercio en el request de creación de pago en el parámetro optional en formato JSon
          example:
            RUT: "7025521-9"
            ID: "899564778"
        pending_info:
          type: object
          description: Información para un pago pendiente cuando se generó un cupón de pago. Si no existen datos es que no se generó un cupón de pago.
          properties:
            media:
              type: string
              nullable: true
              description: El medio de pago utilizado para emitir el cupón de pago
              example: Multicaja
            date:
              type: string
              nullable: true
              description: La fecha de emisión del cupón de pago
              example: '2017-07-21 10:30:12'
        paymentData:
          description: Los datos del pago
          type: object
          properties:
            date:
              type: string
              nullable: true
              description: La fecha de pago
              example: '2017-07-21 12:32:11'
            media:
              type: string
              nullable: true
              description: El medio de pago utilizado
              example: webpay
            conversionDate:
              type: string
              nullable: true
              description: La fecha de conversión de la moneda
              example: '2017-07-21'
            conversionRate:
              type: number
              nullable: true
              format: float
              description: La tasa de conversión.
              example: 1.1
            amount:
              type: number
              nullable: true
              format: float
              description: El monto pagado
              example: 12000
            currency:
              type: string
              nullable: true
              description: La moneda con que se pagó
              example: CLP
            fee:
              type: number
              nullable: true
              format: float
              description: El costo del servicio
              example: 551
            balance:
              type: number
              nullable: true
              format: float
              description: El saldo a depositar
              example: 11499
            transferDate:
              type: string
              nullable: true
              description: La fecha de transferencia de los fondos a su cuenta bancaria.
              example: '2017-07-24'
            mediaType:
              type: string
              nullable: true
              description: Tipo de pago
              example: 'Crédito'
            cardLast4Numbers:
              type: string
              nullable: true
              description: 4 últimos dígito de la tarjeta (si el pago fue con tarjeta).
              example: '9876'
        merchantId:
          description: Id de comercio asociado. Solo aplica si usted es comercio integrador.
          type: string
          nullable: true
        lastError:
          description: Error del último intento
          type: object
          properties:
            code:
              type: string
              nullable: true
              description: Código de error
              example: '01'
            message:
              type: string
              nullable: true
              description: Mensaje de error
              example: 'Tarjeta inválida'
            medioCode:
              type: string
              nullable: true
              description: Código de error del medio de pago
              example: '005'
    PayResponse:
      description: "Datos de retorno de la creación de un link de pago"
      type: object
      properties:
        url:
          type: string
          description: |
            URL ha redireccionar. Para formar el link de pago a esta URL se debe concatenar el token de la siguiente manera:
              url + "?token=" + token
          example: 'https://api.flow.cl'
        token:
          type: string
          description: token de la transacción
          example: "33373581FC32576FAF33C46FC6454B1FFEBD7E1H"
        flowOrder:
          type: number
          description: Número de order de cobro Flow
          example: 8765456
